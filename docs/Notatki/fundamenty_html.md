# Fundamenty HTTP

## Podstawowe metody HTTP

### GET
- U≈ºywana do pobierania danych z serwera
- Parametry sƒÖ przekazywane w URL
- Nie powinna modyfikowaƒá danych na serwerze
- Mo≈ºe byƒá buforowana
- Ma ograniczenia d≈Çugo≈õci URL

### POST
- U≈ºywana do wysy≈Çania danych na serwer
- Dane sƒÖ przesy≈Çane w ciele ≈ºƒÖdania
- Mo≈ºe modyfikowaƒá dane na serwerze
- Nie jest buforowana
- Nie ma ogranicze≈Ñ co do ilo≈õci przesy≈Çanych danych
- Czƒôsto u≈ºywana do tworzenia nowych zasob√≥w

### PUT
- U≈ºywana do aktualizacji istniejƒÖcych zasob√≥w
- Wymaga podania pe≈Çnych danych zasobu
- Jest idempotentna (wielokrotne wywo≈Çanie daje ten sam efekt)
- Czƒôsto u≈ºywana do aktualizacji ca≈Çych zasob√≥w

### DELETE
- U≈ºywana do usuwania zasob√≥w
- Jest idempotentna
- Nie powinna zawieraƒá cia≈Ça ≈ºƒÖdania
- Zwykle zwraca kod 204 (No Content) po pomy≈õlnym usuniƒôciu

### OPTIONS
- U≈ºywana do sprawdzenia dostƒôpnych metod HTTP dla danego endpointu
- Zwraca listƒô obs≈Çugiwanych metod w nag≈Ç√≥wku Allow
- Czƒôsto u≈ºywana w CORS (Cross-Origin Resource Sharing)

### HEAD
- Podobna do GET, ale zwraca tylko nag≈Ç√≥wki odpowiedzi
- Nie zwraca cia≈Ça odpowiedzi
- U≈ºywana do sprawdzenia metadanych zasobu
- Przydatna do weryfikacji czy zas√≥b istnieje

### Przyk≈Çady u≈ºycia

### Podstawowe przyk≈Çady
```http
GET /api/users
POST /api/users
PUT /api/users/123
DELETE /api/users/123
OPTIONS /api/users
HEAD /api/users/123
```

### Rozszerzone przyk≈Çady

#### GET - pobieranie danych
```http
# Pobieranie listy u≈ºytkownik√≥w z filtrowaniem
GET /api/users?role=admin&status=active

# Pobieranie konkretnego u≈ºytkownika
GET /api/users/123

# Pobieranie komentarzy do posta
GET /api/posts/456/comments

# Wyszukiwanie produkt√≥w
GET /api/products?category=electronics&minPrice=100&maxPrice=500
```

#### POST - tworzenie nowych zasob√≥w
```http
# Tworzenie nowego u≈ºytkownika
POST /api/users
{
    "name": "Jan Kowalski",
    "email": "jan@example.com",
    "password": "haslo123"
}

# Dodawanie komentarza
POST /api/posts/456/comments
{
    "content": "≈öwietny artyku≈Ç!",
    "authorId": 789
}

# Logowanie u≈ºytkownika
POST /api/auth/login
{
    "email": "jan@example.com",
    "password": "haslo123"
}
```

#### PUT - aktualizacja zasob√≥w
```http
# Aktualizacja danych u≈ºytkownika
PUT /api/users/123
{
    "name": "Jan Kowalski",
    "email": "jan.nowy@example.com",
    "phone": "123456789"
}

# Aktualizacja statusu zam√≥wienia
PUT /api/orders/789
{
    "status": "shipped",
    "trackingNumber": "TRK123456"
}
```

#### DELETE - usuwanie zasob√≥w
```http
# Usuwanie u≈ºytkownika
DELETE /api/users/123

# Usuwanie komentarza
DELETE /api/posts/456/comments/789

# Anulowanie zam√≥wienia
DELETE /api/orders/789
```

#### OPTIONS - sprawdzanie dostƒôpnych metod
```http
# Sprawdzenie dostƒôpnych metod dla endpointu u≈ºytkownik√≥w
OPTIONS /api/users
# Odpowied≈∫ zawiera nag≈Ç√≥wek Allow: GET, POST, PUT, DELETE

# Sprawdzenie dostƒôpnych metod dla konkretnego u≈ºytkownika
OPTIONS /api/users/123
# Odpowied≈∫ zawiera nag≈Ç√≥wek Allow: GET, PUT, DELETE
```

#### HEAD - sprawdzanie metadanych
```http
# Sprawdzenie czy u≈ºytkownik istnieje
HEAD /api/users/123

# Sprawdzenie czy plik zosta≈Ç zmodyfikowany
HEAD /api/documents/report.pdf

# Sprawdzenie rozmiaru pliku
HEAD /api/downloads/large-file.zip
```

### Przyk≈Çady nag≈Ç√≥wk√≥w odpowiedzi
```http
# Odpowied≈∫ dla GET
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 1234
Cache-Control: max-age=3600

# Odpowied≈∫ dla POST
HTTP/1.1 201 Created
Location: /api/users/123
Content-Type: application/json

# Odpowied≈∫ dla DELETE
HTTP/1.1 204 No Content

# Odpowied≈∫ dla OPTIONS
HTTP/1.1 200 OK
Allow: GET, POST, PUT, DELETE
```

### Kody odpowiedzi

- 200 OK - pomy≈õlne wykonanie ≈ºƒÖdania
- 201 Created - pomy≈õlne utworzenie zasobu (POST)
- 204 No Content - pomy≈õlne wykonanie bez zwracania danych (DELETE)
- 400 Bad Request - nieprawid≈Çowe ≈ºƒÖdanie
- 401 Unauthorized - brak autoryzacji
- 403 Forbidden - brak uprawnie≈Ñ
- 404 Not Found - zas√≥b nie istnieje
- 405 Method Not Allowed - metoda nie jest obs≈Çugiwana

### Zagro≈ºenia bezpiecze≈Ñstwa i potencjalne exploity

### GET - Potencjalne exploity
```http
# Przyk≈Çad exploita XSS poprzez parametry GET
GET /api/search?q=<script>alert('XSS')</script>

# Przyk≈Çad exploita SQL Injection
GET /api/users?id=1' OR '1'='1

# Przyk≈Çad exploita Path Traversal
GET /api/files?path=../../../etc/passwd
```

### POST - Potencjalne exploity
```http
# Przyk≈Çad exploita CSRF
POST /api/transfer
{
    "amount": 1000,
    "to": "attacker_account"
}

# Przyk≈Çad exploita JSON Injection
POST /api/users
{
    "name": {"$gt": ""},
    "role": "admin"
}

# Przyk≈Çad exploita XXE (XML External Entity)
POST /api/upload
Content-Type: application/xml
<?xml version="1.0"?>
<!DOCTYPE data [
    <!ENTITY file SYSTEM "file:///etc/passwd">
]>
<data>&file;</data>
```

### PUT - Potencjalne exploity
```http
# Przyk≈Çad exploita poprzez nadpisanie plik√≥w
PUT /api/files/config.json
{
    "admin": true,
    "permissions": "all"
}

# Przyk≈Çad exploita poprzez modyfikacjƒô uprawnie≈Ñ
PUT /api/users/123/permissions
{
    "role": "admin",
    "access_level": "superuser"
}
```

### DELETE - Potencjalne exploity
```http
# Przyk≈Çad exploita poprzez masowe usuwanie
DELETE /api/users?confirm=false

# Przyk≈Çad exploita poprzez usuwanie systemowych plik√≥w
DELETE /api/files?path=/var/www/html/index.php
```

### Bezpieczne praktyki

1. Walidacja danych wej≈õciowych
   - Sprawdzanie typ√≥w danych
   - Sanityzacja parametr√≥w
   - Walidacja d≈Çugo≈õci i formatu

2. Autoryzacja i uwierzytelnianie
   - U≈ºywanie token√≥w JWT
   - Implementacja CORS
   - Rate limiting

3. Zabezpieczenia przed popularnymi atakami
   - CSRF tokens
   - Content Security Policy (CSP)
   - XSS filters
   - SQL injection prevention

4. Logowanie i monitorowanie
   - Logowanie podejrzanych ≈ºƒÖda≈Ñ
   - Monitorowanie nietypowych wzorc√≥w
   - Alerty bezpiecze≈Ñstwa



---

## Nag≈Ç√≥wki HTTP

Nag≈Ç√≥wki HTTP to **dodatkowe dane przesy≈Çane w ≈ºƒÖdaniu (request)** lub odpowiedzi (response). S≈Çu≈ºƒÖ np. do identyfikacji klienta, autoryzacji, przesy≈Çania ciasteczek, itp.

---

###  Kluczowe nag≈Ç√≥wki HTTP

### üß† `User-Agent`

Opisuje przeglƒÖdarkƒô lub klienta, kt√≥ry wysy≈Ça ≈ºƒÖdanie.
Przyk≈Çad:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/124.0
```
Mo≈ºna go ≈Çatwo spoofowaƒá, np. przy crawlingu albo testach bot√≥w.

üîç W pentestingu: sprawdzasz, czy backend rozr√≥≈ºnia klient√≥w (np. ‚Äûdostƒôp tylko dla Safari").

Przyk≈Çady:
1. Zmiana User-Agent na starszƒÖ wersjƒô przeglƒÖdarki:
```
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/80.0
```
2. Spoofing na boty wyszukiwarek:
```
User-Agent: Googlebot/2.1
```
3. Testowanie dostƒôpu tylko dla mobilnych:
```
User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)
```

---

### üß† `Host`

Wskazuje, do jakiego hosta kierowane jest ≈ºƒÖdanie.
Przyk≈Çad:
```
Host: login.mojadomena.pl
```
Umo≈ºliwia serwerowi rozr√≥≈ºniƒá, do kt√≥rej domeny klient siƒô odwo≈Çuje (wa≈ºne przy virtual hosting).

üîç W pentestingu: testujesz Host Header Injection, np. przekierowania zale≈ºne od `Host`.

Przyk≈Çady:
1. Testowanie przekierowa≈Ñ:
```
Host: evil.com
```
2. Cache poisoning:
```
Host: example.com
X-Forwarded-Host: evil.com
```
3. Bypass WAF:
```
Host: 127.0.0.1
```

---

### üç™ `Cookie`

Przesy≈Ça ciasteczka (np. sesyjne, identyfikacyjne).
Przyk≈Çad:
```
Cookie: sessionid=abc123; is_admin=true
```

üîç W pentestingu: testujesz przejƒôcie sesji (Session Fixation / Session Hijacking), manipulujesz ciastkami, np. `is_admin=true`.

Przyk≈Çady:
1. Session Fixation:
```
Cookie: PHPSESSID=123456789
```
2. Manipulacja uprawnieniami:
```
Cookie: role=admin; is_admin=1; access_level=superuser
```
3. XSS w ciasteczkach:
```
Cookie: user=<script>alert(1)</script>
```

---

### üß† `Referer` *(z liter√≥wkƒÖ z historycznych powod√≥w)*

Pokazuje skƒÖd przysz≈Ço ≈ºƒÖdanie, czyli URL strony, z kt√≥rej u≈ºytkownik kliknƒÖ≈Ç link.
Przyk≈Çad:
```
Referer: https://example.com/login
```

üîç W pentestingu: mo≈ºesz sprawdzaƒá, czy aplikacja ufa Refererowi, np. w przypadku ‚Äûtylko u≈ºytkownicy z naszej strony mogƒÖ...". Przydaje siƒô do testowania CSRF, je≈õli Referer jest jedynym zabezpieczeniem.

Przyk≈Çady:
1. Bypass sprawdzania Referer:
```
Referer: https://trusted-site.com
```
2. CSRF exploit:
```
Referer: https://evil.com
```
3. Empty Referer:
```
Referer: 
```

---

### üß† `Origin`

Pokazuje domenƒô ≈∫r√≥d≈ÇowƒÖ bez ≈õcie≈ºki (bardziej zaufany ni≈º Referer).
Przyk≈Çad:
```
Origin: https://mojastrona.pl
```

üîç W pentestingu: bardzo wa≈ºny przy CORS (Cross-Origin Resource Sharing)! Je≈õli Origin jest ≈∫le sprawdzany ‚Üí CORS misconfiguration ‚Üí mo≈ºna kra≈õƒá dane z cudzych sesji.

Przyk≈Çady:
1. CORS bypass:
```
Origin: https://evil.com
```
2. Null Origin:
```
Origin: null
```
3. Spoofing zaufanej domeny:
```
Origin: https://trusted-site.com
```

---

### üß†`Authorization`

Przesy≈Ça token lub dane logowania.
Przyk≈Çad (Basic Auth):
```
Authorization: Basic dXNlcjpwYXNz
```
Przyk≈Çad (Bearer token):
```
Authorization: Bearer eyJhbGciOi...
```

üîç W pentestingu: testujesz czy tokeny sƒÖ przewidywalne, czy mo≈ºna u≈ºywaƒá tokenu z innym u≈ºytkownikiem, czy mo≈ºna zadzia≈Çaƒá bez nag≈Ç√≥wka i uzyskaƒá dostƒôp (Broken Access Control).

Przyk≈Çady:
1. Token replay:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```
2. Basic Auth bypass:
```
Authorization: Basic YWRtaW46YWRtaW4=
```
3. JWT manipulation:
```
Authorization: Bearer eyJhbGciOiJub25lIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
```

### Cheat sheet

| Nag≈Ç√≥wek        | Co robi?                                | Pentesting zastosowanie           |
| --------------- | --------------------------------------- | --------------------------------- |
| `User-Agent`    | Identyfikuje klienta (np. przeglƒÖdarkƒô) | Bypassy, bot detection, spoofing  |
| `Host`          | Do jakiej domeny jest ≈ºƒÖdanie           | Host Header Injection             |
| `Cookie`        | Przesy≈Ça dane sesji                     | Session Hijack / Manipulacja      |
| `Referer`       | Z jakiej strony przyszed≈Ç u≈ºytkownik    | CSRF, redirecty, sprawdzanie flow |
| `Origin`        | Z jakiej domeny pochodzi przeglƒÖdarka   | CORS exploity                     |
| `Authorization` | Dane logowania/token                    | Auth bypass, token replay, brute  |


---
Okej, robimy porzƒÖdne **wprowadzenie do cookies, sesji i token√≥w**, jakiego potrzebuje ka≈ºdy kto wchodzi w **web pentesting** üîê
Bƒôdzie zrozumiale, ale dok≈Çadnie ‚Äì bez owijania w bawe≈Çnƒô üòà

---

## Cookies, Sesje i Tokeny

---

###  Co to sƒÖ cookies?

* Cookies to **ma≈Çe dane** (key-value) wysy≈Çane przez serwer do przeglƒÖdarki.
* PrzeglƒÖdarka **automatycznie je do≈ÇƒÖcza** do ka≈ºdego requestu do tej samej domeny.

**Przyk≈Çad:**

```
Set-Cookie: sessionid=abc123; HttpOnly; Secure; Path=/; SameSite=Lax
```

---

###  Co mo≈ºe byƒá w cookies?

| Klucz                     | Opis                                                    |
| ------------------------- | ------------------------------------------------------- |
| `sessionid`               | ID Twojej sesji (czƒôsto losowe)                         |
| `auth_token`, `jwt`       | Token JWT lub inny do autoryzacji                       |
| `isAdmin=1`, `user=admin` | Czasem aplikacje trzymajƒÖ role w cookies (z≈Çe praktyki) |
| `lang=en`, `theme=dark`   | Preferencje u≈ºytkownika                                 |
| `csrftoken=XYZ`           | Token anty-CSRF                                         |

---

###  Atrybuty cookies (bardzo wa≈ºne!)

| Atrybut       | Znaczenie                                   | Bezpiecze≈Ñstwo                       |
| ------------- | ------------------------------------------- | ------------------------------------ |
| `HttpOnly`    | Nie mo≈ºna odczytaƒá przez JS                 | üîí Chroni przed XSS kradnƒÖcym cookie |
| `Secure`      | Wysy≈Çane tylko przez HTTPS                  | üîí Chroni przed sniffingiem na HTTP  |
| `SameSite`    | Ogranicza wysy≈Çanie do "tej samej strony"   | üîí Chroni przed CSRF                 |
| `Path=/admin` | Ogranicza u≈ºycie do konkretnego patha       | üëÄ Czasem pozwala co≈õ obej≈õƒá         |
| `Domain`      | Umo≈ºliwia wsp√≥≈Çdzielenie miƒôdzy subdomenami | üî• Ryzykowne przy wielu subdomenach  |

---

### Czym jest sesja?

* **Stan po stronie serwera** ‚Äì np. kto jeste≈õ, czy jeste≈õ zalogowany.
* Identyfikator sesji (np. `sessionid=abc123`) trzymany jest w **cookie**.
* Backend wie, ≈ºe `abc123` = np. u≈ºytkownik `adam`, rola `admin`.

**Uwaga:** Je≈õli mo≈ºesz zgadnƒÖƒá / ukra≈õƒá `sessionid` ‚Üí **przejƒÖ≈Çe≈õ konto** (Session Hijacking).

---

###  Tokeny autoryzacyjne (np. JWT)

Zamiast sesji na serwerze mo≈ºna u≈ºywaƒá **token√≥w** ‚Äì np. **JWT (JSON Web Token)**.

**Przyk≈Çad tokena JWT:**

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZX0.signature
```

Sk≈Çada siƒô z 3 czƒô≈õci:

* **Header** ‚Äì info o algorytmie (`alg`, `typ`)
* **Payload** ‚Äì dane u≈ºytkownika (`admin`, `id`, `email`)
* **Signature** ‚Äì podpis cyfrowy

**Zaleta**: Nie trzeba trzymaƒá nic po stronie serwera
**Ryzyko**: Je≈õli JWT jest ≈∫le skonfigurowany, mo≈ºna go podrobiƒá.

---

### Co atakujemy?

| Co widzisz?               | Co mo≈ºesz zrobiƒá?                                                                                                |
| ------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| Cookie `sessionid=XYZ`    | üî∏ Pr√≥buj przejƒÖƒá (XSS, MitM, bruteforce ID)<br>üî∏ Pr√≥buj go zmieniƒá                                             |
| Cookie `isAdmin=true`     | üî∏ Podmie≈Ñ na `false` / `1` / `0` i testuj dostƒôp                                                                |
| JWT token w Authorization | üî∏ Zmie≈Ñ payload (`admin=true`) i zobacz czy dzia≈Ça<br>üî∏ Sprawd≈∫ alg=none<br>üî∏ Spr√≥buj brute-force HMAC klucza |
| Brak `HttpOnly`           | üî• XSS ‚Üí document.cookie = kradzie≈º sesji                                                                        |
| Brak `SameSite`           | üî• CSRF mo≈ºliwy                                                                                                  |
| Z≈Çy `Domain`              | üî• Mo≈ºna przejƒÖƒá subdomenƒô i ukra≈õƒá cookies                                                                      |

---

###  Jak testowaƒá w Burpie?

* Zobacz zak≈Çadkƒô **Cookies** w requestach i odpowiedziach
* Sprawdzaj:

  * Czy `Set-Cookie` ustawia bezpieczne flagi?
  * Czy mo≈ºesz rƒôcznie edytowaƒá cookie i zyskaƒá dostƒôp?
  * Czy mo≈ºesz przejƒÖƒá sesjƒô?
* JWT mo≈ºna ≈Çatwo rozkodowaƒá (np. [jwt.io](https://jwt.io)) i fuzzowaƒá payloady

---

###  Klasyczne ataki:

| Atak                     | Opis                                                 |
| ------------------------ | ---------------------------------------------------- |
| **Session Fixation**     | Wymuszasz sesjƒô na ofierze, a potem jƒÖ przejmujesz   |
| **Session Hijacking**    | Kradniesz cudze cookies (np. przez XSS)              |
| **JWT alg=none**         | JWT bez podpisu = ka≈ºdy mo≈ºe wygenerowaƒá token       |
| **Privilege Escalation** | Masz token usera ‚Üí zmieniasz payload na `admin=true` |
| **CSRF**                 | Wysy≈Çasz request ofiary z jej cookies bez jej wiedzy |

---
